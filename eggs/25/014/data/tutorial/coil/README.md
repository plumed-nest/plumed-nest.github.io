# Tutorial for random coil ensemble preparation

<p align="center">
  <img src="coil.png" width="400">
</p>

These are the steps to do ensemble modelling using a random coil model.
Each step of the procedure will be carried out in a separate directory.
We note that the steps are very similar to that of the bAIes simulations.

## 1. Preparation
**Working directory**: `1-preparation`

To generate the lammps files, we need the topology information of the protein and the force field. 
In our framework, this is done by converting gromacs files into lammps with a special python package. 
We therefore need to prepare GROMACS files at first:

The input of this step is the pdb model of the protein (which can be taken from Alphafold outputs).

In a terminal run:

`./step1-prepare_gmx.bash relaxed_model_4_ptm_pred_0.pdb`

This script runs gromacs commands that will take this pdb model and make GROMACS files out of it using the amber99SB-ILDN force field.
The outputs should contain `.gro`, `.itp`, `.top` and `.pdb` files.

## 2. Conversion to LAMMPS
**Working directory**: `3-conversion`

**Environment requirement**: In this step, it is important that you activate the baies environment before running `step3-conversion.bash`: `conda activate baies`. To obtain this environment, look at the software requirements.

In this step, the files generated in step 1 and 2 will be used to generate the final outputs for the random coil simulation.

The inputs for this step are:

* The `.gro`, `.pdb` and `.top` files generated by GROMACS in the first step. They will be used for the conversion to LAMMPS.

* A file containing some additional force information for the final force field (`cmap_20240524.cmap`).

In a terminal, run:

`./step2-conversion.bash idp.gro idp.pdb idp.top`

This script does two things:

* First, it uses the python intermol library to convert the GROMACS files into LAMMPS files.

* Second, the `make_ff.py` script reads the LAMMPS and .cmap files and generates the final lammps inputs with the simplified force field.

The expected outputs are:

* A file ending with `_nvt.in` which is the LAMMPS input file. It contain all the basic information and settings for the LAMMPS simulations.

* A file ending with `_nvt.data` which contain force and topology information about the system. It is read by the LAMMPS input file.

## 3. Simulation
**Working directory**: `3-simulation`

In this step, we describe how to run random coil simulations.

To run a simulation, we need to following in our directory:

* The LAMMPS input files containing the information about the system and the force field generated in step 2. They are composed by three files: `idp_nvt.in`, `idp_nvt.data` and `cmap_20240524.cmap`.

* The `idp.pdb` file generated by GROMACS in step 1.

A random coil simulation can be run in a terminal with the following command:

`lmp -in idp_nvt.in`

Of course, the LAMMPS input file `idp_nvt.in` can be modified to adjust the parameters of the simulation. Specifically, at the end of the file, some key lines can be adjusted to fit the purpose of the user:

* `dump 1 all xtc 10000 traj_idp.xtc`: This line states that LAMMPS will record every 10000 steps (10ps if the timestep is maintained at 1fs) and save it in an xtc file named `traj_idp.xtc`
* `run    2000000000`: This line specifies the number of steps to run for the simulation. In this example, 2G steps corresponds to 2 microseconds.

The xtc format is convenient because some simple tasks can be performed in one line in the terminal to perform some simple analysis with the GROMACS tool.
* To obtain some basic information about your trajectory, run `gmx check -f traj_idp.xtc`
* To keep only the structures every 100ps, run `gmx trjconv -f traj_idp.xtc -s idp.pdb -o traj_idp_dt100ps.xtc -dt 100000`


